name: Dependency Update Check

on:
  schedule:
    # æ¯å‘¨ä¸€ä¸Šåˆ 9:00 UTC è¿è¡Œ
    - cron: '0 9 * * 1'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  check-updates:
    name: Check for dependency updates
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Check for outdated packages
      run: npm outdated || true
      
    - name: Check for security vulnerabilities
      run: npm audit --audit-level=moderate
      
    - name: Create issue if updates available
      if: failure()
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: 'ğŸ“¦ Dependency Updates Available',
            body: `
            ## ä¾èµ–åŒ…æ›´æ–°æé†’
            
            è‡ªåŠ¨æ£€æµ‹åˆ°é¡¹ç›®æœ‰å¯æ›´æ–°çš„ä¾èµ–åŒ…æˆ–å®‰å…¨æ¼æ´ã€‚
            
            ### å»ºè®®æ“ä½œï¼š
            1. è¿è¡Œ \`npm audit fix\` ä¿®å¤å®‰å…¨æ¼æ´
            2. æ£€æŸ¥ \`npm outdated\` è¾“å‡ºï¼Œè€ƒè™‘æ›´æ–°è¿‡æ—¶çš„åŒ…
            3. æµ‹è¯•æ›´æ–°åçš„å…¼å®¹æ€§
            
            ---
            *æ­¤é—®é¢˜ç”±è‡ªåŠ¨åŒ–å·¥ä½œæµåˆ›å»ºäº ${new Date().toISOString()}*
            `,
            labels: ['dependencies', 'maintenance']
          })